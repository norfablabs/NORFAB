{% set connections = netbox.get_connections(devices=[host.name]) -%}

{% for interface, connection in connections.items() -%}
{% set subnet_description = [host.name + ":" + interface, connection["remote_device"] + ":" + connection["remote_interface"]] | sort | join(" - ptp - ") -%}
{% set ip = netbox.create_prefix("10.1.0.0/24", subnet_description, 30) | netbox.create_ip(host.name, interface) %}
interface {{ interface }}
  ip address {{ ip }}
!
{% endfor %}